# RAN Digital Twin Simulation

## Overview

This repository contains scripts and configurations for building a RAN (Radio Access Network) Digital Twin simulation. The simulation architecture includes a 5G core network, an RIC (RAN Intelligent Controller), disaggregated gNB (CU/DU), and multiple dedicated UE instances. It also supports 4G UEs with the `srs4G` build option. The entire setup is designed to be modular, allowing customization and deployment in different modes (Core, Edge, etc.).

### Key Components

- **Open5GS 5GC Core**: Core Network components such as MME/AMF/SGW/PGW.
- **OSC RIC**: Modified Open Source RAN Intelligent Controller supporting machine virtualization.
- **srsRAN gNB**: Disaggregated CU/DU for the gNB.
- **srsUE**: Multiple instances of dedicated UE using srsRAN.
- **GNU Radio**: Modulation and RF signal processing for the UEs.

## Directory Structure

```plaintext
├── compile/                            # Compilation scripts for building various components
│   ├── open5gs.sh                      # Builds and configures Open5GS 5G Core
│   ├── osc-ric.sh                      # Builds and configures OSC RIC on a class-C subnet
│   ├── srs4G.sh                        # Builds and installs srsRAN 4G UE
│   ├── srs_project.sh                  # Builds and installs srsRAN project
│   ├── srsgnb.sh                       # Builds srsRAN gNB config: Currently supports single gNB @ Core
|   ├── srsue.sh                        # Builds srsUE configs and synchronizes with Open5GS database
|   └── gnuradio.sh                     # Builds gnuradio configs: Currently hardcodes 3 UEs but goal is to be synchonized with srsue
├── configs/                            # Configuration files for UEs and other components
│   ├── subscriber_db.csv               # List of subscribers (IMSI, Keys, OP/OPC, etc.)
│   ├── subscriber_template_db.csv      # List of subscribers (IMSI, Keys, OP/OPC, etc.)
│   ├── gnb_zmq.yaml                    # Template for UE ZMQ configuration files
│   ├── ue_template_zmq.conf            # Template for UE ZMQ configuration files
│   ├── <generated_ue_files>            # UE-specific configuration files generated by scripts
│   └── multi_ue_scenario.grc           # gnuradio config file for modulating multi-UE simulations
├── oran-sc-ric/                        # Source files and builds for OSC RIC (added after build)
├── srsRAN_4G/                          # Source files and builds for srsRAN 4G UE (added after build)
├── srsRAN_Project/                     # Source files and builds for srsRAN project (added after build)
├── build-digital-twin.sh               # Main script to build and deploy the RAN Digital Twin
└── README.md                           # Documentation for the project
```

## Scripts

### `build-digital-twin.sh`
The primary script for building the entire RAN Digital Twin environment. This script automates the deployment of the RAN architecture, including the core network, RIC, gNB, and UE instances.

#### Usage

```bash
./build-digital-twin.sh [options]
```
### Options:

- `-mode [core|edge]`: Specify the mode of the RAN network (default: core).
- `-hostip <ip_address>`: Override the default static IP for the host machine (default: disabled).
- `-int <interface>`: Specify the network interface to configure the static IP (default: 10.0.2.15).
- `-srsP [T|F]`: Enable/Disable building the srsRAN Project package (default T).
- `-srs4G [T|F]`: Enable/Disable building the srs4G package (default: T).
- `-ue <num>`: Specify the total number of UEs to build (default: 3).
- `-ue_local <num>`: Specify the number of UEs to build on this machine (default: matches -ue).
- `-ue_idx <index>`: Specify the starting index of UEs for this machine (default: 1).

---

### compile/open5gs.sh

Script to build and configure the Open5GS 5GC Core (MME/AMF/SGW/PGW).

---

### compile/osc-ric.sh

Script to build and configure the OSC RIC, supporting machine virtualization and performance monitoring.

---

### compile/srs4G.sh

Script to build and configure the srsRAN 4G UE. This adds support for multiple dedicated UE instances, using the srsRAN project.

---

### compile/srs_project.sh

Script to build the srsRAN Project, which includes various components such as the gNB (CU/DU).

---

### compile/srsgnb.sh

Script to build the disaggregated CU/DU for the srsRAN gNB.

---

### srsue.sh

This script generates multiple UE configuration files (`ue*_zmq.conf`) based on the number of UEs and the starting index provided as arguments. It retrieves USIM data (IMSI, Key, OP/OPc) from the `subscriber_db.csv` file and updates the configuration for each UE.
This script is automatically called during built. It can be called outside of build to generate additional UEs, but be wary that any UE not contained within the `subscriber_db.csv` file will not be able to subscribe to the network!

---

### Usage
```bash
./srsue.sh <NUM_UES> <START_INDEX>
```

### Configuration Files (`configs/`)

- **`subscriber_db.csv`**: Contains the subscriber information such as IMSI, Key, and OPC values. The script uses this file to populate each UE configuration.
- **`gnb_zmq.yaml`**: A template configuration file used to generate gnb configuration files. Synchronized with modified RIC configuration.
- **`ue_template_zmq.conf`**: A template configuration file used to generate UE-specific configuration files.

The **`srsue.sh`**: script will create individual configuration files for each UE (ueX_zmq.conf) based on this template and the data from subscriber_db.csv.

## Build Process

1. **Clone and build**: After running the build script, the following directories will be created and populated with source files and build outputs:
   - `oran-sc-ric/`: Contains the OSC RIC build.
   - `srsRAN_4G/`: Contains the build and binaries for the srs4G UE.
   - `srsRAN_Project/`: Contains the build and binaries for the srsRAN project.

2. **Generate UEs**: `srsue.sh` script is leveraged during build to generate configuration files for the passed in number of UEs. Build automatically stages all configuration files in the appropriate directories for deployment.

3. **Run the simulation**: Once everything is built, the simulation is ready for deployment, with the RAN architecture functioning in a virtualized environment.

## Installed xApps 
### Must deploy RAN before deploying xApps

1. **KPIMon**: Monitors performance metrics at the core network via terminal CLI. 

2. **Grafana**: Monitors performance metrics at the gNB via a browser window @ `localhost:3300`.

---

## Future Enhancements

- Add `deploy-digital-twin.sh` to build the network stack in sequence across multiple VM terminals
- Enhance `build-digital-twin.sh` to prompt for a `deploy-digital-twin.sh` call, passing in all built UEs 
- Add support for edge RAN deployments: Hosting UEs from a separate VM for processing offload
- Integration with additional xApps for enhanced performance monitoring.
- Expand signal modulation and RF waveform processing using GNU Radio.

## References

The srsProject Documentation was leveraged as a starting point for this repository, which is an orchestration framework for combining several packages and automating their configuration:  
[srsProject Documentation](https://docs.srsran.com/projects/project/en/latest/tutorials/source/near-rt-ric/source/index.html)

## Contact

For further assistance, feel free to contact the **Clemson University IS-WiN Laboratory ORAN team** led by Tolunay Sefyi, Ryan Barker, and Basir Reze.
